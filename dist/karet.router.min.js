!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("karet"),require("karet.util"),require("prop-types"),require("ramda"),require("path-to-regexp"),require("kefir"),require("history"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","karet","karet.util","prop-types","ramda","path-to-regexp","kefir","history","partial.lenses"],r):r((e.karet=e.karet||{},e.karet.router=e.karet.router||{}),e.karet,e.U,e.P,e.R,e.toRegex,e.Kefir,e.H,e.L)}(this,function(e,r,t,n,o,a,i,u,c){"use strict";function f(e,r){var t={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}r="default"in r?r.default:r;var p=t.default;a="default"in a?a.default:a;var s=function(e){e.preventDefault(),e.stopPropagation()},l=t.lift1Shallow(function(e){return/^https?:\/\//.test(e)}),y=o.compose(o.map(o.zipObj(["route","Component"])),o.toPairs),h=o.map(function(e){var r=a(e.route);return r.keys=r.keys.map(o.prop("name")),o.assoc("regex",r,e)}),v=o.sortBy(function(e){return 0===e.regex.keys.length?0:1}),m=o.compose(v,h,y),d=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},k=function(){function e(e,r){var t=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),b=function(e){return!!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)},x=o.curry(function(e,r,t){if(s(t),!b(t)){var n=/^((\/[^?#]*)([?][^#]*)?)?([#].*)?$/.exec(r),o=k(n,5),a=o[2],i=void 0===a?"":a,u=o[3],c=void 0===u?"":u,f=o[4],p=void 0===f?"":f;l(r)||e.set({pathname:i,search:c,hash:p})}}),g=t.withContext(function(e,t){var n=t["karet.router"].location,o=e.href,a=(e.onClick,f(e,["href","onClick"]));return r.createElement("a",d({href:o,onClick:x(n,o)},a))});g.propTypes={href:n.string,onClick:n.func};var O=o.pipe(c.collect([c.props("pathname","search","hash"),c.values]),o.join("")),j=u.createBrowserHistory(),w=function(){return j.location},q=t.atom(w());i.stream(function(e){j.listen(function(r,t){return e.emit({next:r,action:t})})}).observe(function(e){var r=e.next;return"POP"===e.action&&q.set(r)}),q.observe(function(e){o.equals(e,w())||j.push(O(e))});var C=function(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}({},"karet.router",{location:q,pathname:t.view("pathname",q)}),P=o.curry(function(e,t){for(var n=0,a=e.length;n<a;n++){var i=e[n],u=i.Component,c=i.regex,f=c.exec(t);if(f)return r.createElement(u,{params:o.zipObj(c.keys,o.tail(f))})}}),K=t.withContext(function(e,r){var n=e.routes,o=r["karet.router"].pathname;return t.fromKefir(p(o,P(n)))});K.propTypes={routes:n.arrayOf(n.object)};var E=function(e){var n=e.routes,o=m(n);return r.createElement(t.Context,{context:C},r.createElement(K,{routes:o}))};E.propTypes={routes:n.object},e.Link=g,e.Router=E,Object.defineProperty(e,"__esModule",{value:!0})});
